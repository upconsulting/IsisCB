{% extends "isisdata/__base.html" %}
{% load app_filters %}
{% load static %}
{% load search_filters %}
{% load authority_filters %}
{% load facet_filters %}

{% block extra_head %}
<script>
{% if source_instance_id %}
var SUBJECT_INSTANCE_ID = "{{ source_instance_id }}";
{% endif %}

{% if source_content_type %}
var SUBJECT_CONTENT_TYPE = {{ source_content_type }};
{% endif %}
</script>
<script src="{% static "isisdata/js/comments.js" %}"></script>

<script src="{% static 'isisdata/js/plotly-latest.min.js' %}" type="text/javascript"></script>

<style>
.panel-default>.panel-heading-relation {
  background-color: #e0eef5;
}

.panel-default>.panel-heading-subjects {
  background-color: #eaeaea;
}

.panel-default>.panel-heading-links {
  background-color: #e4cfe2;
}

.panel-default>.panel-heading-links a {
  color: #8533b7;
}

.panel-default>.panel-body-links a {
  color: #8533b7;
}

.truncate {
  text-overflow: ellipsis;
  overflow: hidden;
  display: -webkit-box;
   -webkit-line-clamp: 7;
   -webkit-box-orient: vertical;
}

</style>

<link rel="unapi-server" type="application/xml" title="unAPI" href="http://{{ request.get_host }}/isis/unapi">


<meta property="og:url"                content="{{ request.build_absolute_uri }}" />
<meta property="og:site_name"          content="Isis Current Bibliography" />
<meta property="og:type"               content="article" />
<meta property="fb:app_id"             content="{{ facebook_app_id}}" />
<meta property="og:title"              content="{{ authority.name|strip_tags }}" />
<meta property="og:description"        content="{{ authority.description|strip_tags }}" />
<!-- TODO: -vv- if we add images for entries, this should be changed. -vv-  -->
<meta property="og:image"              content="{% static "isisdata/images/isis_final_black.png" %}" />
{% endblock %}



{#% block title %}Authority{% endblock %#}



{% block content %}
<div class="row">
  <div class="col-sm-12 col-md-3" style="padding-right:0;">
    {% include 'isisdata/authority_fragments/fragment_authority_info_box.html' %}
  </div>
  <div class="col-sm-12 col-md-9">
    <div class="row">
      <div class="col-sm-12 col-md-6">
        {% include 'isisdata/authority_fragments/fragment_authority_publications_graph.html' %}
      </div>
      <div class="col-sm-12 col-md-6">
        {% include 'isisdata/authority_fragments/fragment_authority_places_facet.html' %}
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-4">
        <div class="panel panel-default facet-box">
          <div class="panel-heading-relation panel-heading">
            <strong>Related Authors & Contributors</strong>
            <a class="pull-right" style="color:black" data-container="body" data-toggle="popover"
              data-placement="right" data-trigger="focus" tabindex="0" role="button"
              data-content="This list shows authors, editors, etc. of Citation records linked to this Authority record.">
              <i class="far fa-question-circle" aria-hidden="true"></i>
            </a>
          </div>
          <div class="panel-body">
            {% for facet in related_contributors_facet|slice:"7" %}
            {% include 'isisdata/fragment_facet_link.html' with facet_field='citation_all_contributor_ids_exact'%}
            {% endfor %}

            {% if related_contributors_facet|length > 7 %}
            <button type="button" class="btn btn-xs btn-primary" data-toggle="modal" data-target="#authorModal" style="float:right">
              More <i class="far fa-caret-square-down"></i>
            </button>
            {% endif %}
          </div>
        </div>

        <div class="panel panel-default facet-box">
          <div class="panel-heading panel-heading-relation">
            <strong>Related Journals</strong>
            <a class="pull-right" style="color:black" data-container="body" data-toggle="popover"
              data-placement="right" data-trigger="focus" tabindex="0" role="button"
              data-content="This list shows journals of Citation records linked to this Authority record.">
              <i class="far fa-question-circle" aria-hidden="true"></i>
            </a>
          </div>
          <div class="panel-body">
            {% for facet in related_journal_facet|slice:"7" %}
            {% include 'isisdata/fragment_facet_link.html' with facet_field='citation_periodical_ids' %}
            {% endfor %}

            {% if related_journal_facet|length > 7 %}
            <button type="button" class="btn btn-xs btn-primary" data-toggle="modal" data-target="#journalModal" style="float:right">
              More <i class="far fa-caret-square-down"></i>
            </button>
            {% endif %}
          </div>
        </div>

        <div class="panel panel-default facet-box">
          <div class="panel-heading panel-heading-relation">
            <strong>Related Publisher</strong>
            <a class="pull-right" style="color:black" data-container="body" data-toggle="popover"
              data-placement="right" data-trigger="focus" tabindex="0" role="button"
              data-content="This list shows publishers of Citation records linked to this Authority record.">
              <i class="far fa-question-circle" aria-hidden="true"></i>
            </a>
          </div>
          <div class="panel-body">
            {% for facet in related_publisher_facet|slice:"7" %}
            {% include 'isisdata/fragment_facet_link.html' with facet_field='citation_publisher_ids' %}
            {% endfor %}

            {% if related_publisher_facet|length > 7 %}
            <button type="button" class="btn btn-xs btn-primary" data-toggle="modal" data-target="#publisherModal" style="float:right">
              More <i class="far fa-caret-square-down"></i>
            </button>
            {% endif %}
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading panel-heading">
            <strong>Datasets</strong>
            <a class="pull-right" style="color:black" data-container="body" data-toggle="popover"
              data-placement="right" data-trigger="focus" tabindex="0" role="button"
              data-content="This list shows publishers of Citation records linked to this Authority record.">
              <i class="far fa-question-circle" aria-hidden="true"></i>
            </a>
          </div>
          <div class="panel-body">
            {% for facet in related_dataset_facet|slice:"7" %}
            <i class="fa fa-database" aria-hidden="true"></i> {% with facet.0 as authority_name %}


            <a href="{% url 'haystack_search' %}?q=(author_ids:{{ authority.id }} OR contributor_ids:{{ authority.id }} OR editor_ids:{{ authority.id }} OR subject_ids:{{ authority.id }} OR institution_ids:{{ authority.id }} OR category_ids:{{ authority.id }} OR advisor_ids:{{ authority.id }} OR translator_ids:{{ authority.id }} OR publisher_ids:{{ authority.id }} OR school_ids:{{ authority.id }} OR meeting_ids:{{ authority.id }} OR periodical_ids:{{ authority.id }} OR book_series_ids:{{ authority.id }} OR time_period_ids:{{ authority.id }} OR geographic_ids:{{ authority.id }} OR about_person_ids:{{ authority.id }} OR other_person_ids:{{ authority.id }})&models=isisdata.citation&sort_order=publication_date_for_sort&sort_order_dir=descend&raw_search=True&selected_facets=citation_dataset_typed_names_exact:{{facet.0|urlencode}}">
               {{authority_name}} ({{facet.1}} citations)
            </a>

            {% endwith %}
            <br>
            {% endfor %}
          </div>
        </div>
      </div>
      <div class="col-sm-12 col-md-4">
        <div class="panel panel-primary facet-box">
          <div class="panel-heading-subjects panel-heading">
            <strong>Related People</strong>
            <a class="pull-right" style="color:black" data-container="body" data-toggle="popover"
              data-placement="right" data-trigger="focus" tabindex="0" role="button"
              data-content="This list shows relationships to subject terms of Citation records linked to this Authority record.">
              <i class="far fa-question-circle" aria-hidden="true"></i>
            </a>
          </div>
          <div class="panel-body">
            {% for facet in related_subject_people_facet|slice:"7" %}
            {% include 'isisdata/fragment_facet_link.html' with facet_field='citation_people_by_subject_ids'%}
            {% endfor %}

            {% if related_subject_people_facet|length > 7 %}
            <button type="button" class="btn btn-xs btn-primary" data-toggle="modal" data-target="#peopleModal" style="float:right">
              More <i class="far fa-caret-square-down"></i>
            </button>
            {% endif %}
          </div>
        </div>

        <div class="panel panel-primary facet-box">
          <div class="panel-heading-subjects panel-heading">
            <strong>Related Institutions </strong>
            <a class="pull-right" style="color:black" data-container="body" data-toggle="popover"
              data-placement="right" data-trigger="focus" tabindex="0" role="button"
              data-content="This list shows relationships to subject terms of Citation records linked to this Authority record.">
              <i class="far fa-question-circle" aria-hidden="true"></i>
            </a>
          </div>
          <div class="panel-body">
            {% for facet in related_subject_institutions_facet|slice:"7" %}
            {% include 'isisdata/fragment_facet_link.html' with facet_field='citation_institutions_by_subject_ids_exact'%}
            {% endfor %}

            {% if related_subject_institutions_facet|length > 7 %}
            <button type="button" class="btn btn-xs btn-primary" data-toggle="modal" data-target="#institutionModal" style="float:right">
              More <i class="far fa-caret-square-down"></i>
            </button>
            {% endif %}
          </div>
        </div>

        <div class="panel panel-primary facet-box">
          <div class="panel-heading-subjects panel-heading">
            <strong>Related Categories</strong>
            <a class="pull-right" style="color:black" data-container="body" data-toggle="popover"
              data-placement="right" data-trigger="focus" tabindex="0" role="button"
              data-content="This list shows relationships to category terms of Citation records linked to this Authority record.">
              <i class="far fa-question-circle" aria-hidden="true"></i>
            </a>
          </div>
          <div class="panel-body">
            {% for facet in related_categories_facet|slice:"7" %}
            {% include 'isisdata/fragment_facet_link.html' with facet_field='citation_category_ids_exact' %}
            {% endfor %}

            {% if related_categories_facet|length > 7 %}
            <button type="button" class="btn btn-xs btn-primary" data-toggle="modal" data-target="#categoryModal" style="float:right">
              More <i class="far fa-caret-square-down"></i>
            </button>
            {% endif %}
          </div>
        </div>
      </div>
      <div class="col-sm-12 col-md-4">
        <div class="panel panel-primary facet-box">
          <div class="panel-heading-subjects panel-heading">
            <strong>Related Concepts</strong>
            <a class="pull-right" style="color:black" data-container="body" data-toggle="popover"
              data-placement="right" data-trigger="focus" tabindex="0" role="button"
              data-content="This list shows relationships to subject terms of Citation records linked to this Authority record.">
              <i class="far fa-question-circle" aria-hidden="true"></i>
            </a>
          </div>
          <div class="panel-body">
            {% for facet in related_subject_concepts_facet|slice:"7" %}
            {% include 'isisdata/fragment_facet_link.html' with facet_field='citation_concepts_by_subject_ids_exact' %}
            {% endfor %}

            {% if related_subject_concepts_facet|length > 7 %}
            <button type="button" class="btn btn-xs btn-primary" data-toggle="modal" data-target="#subjectModal" style="float:right">
              More <i class="far fa-caret-square-down"></i>
            </button>
            {% endif %}
          </div>
        </div>

        <div class="panel panel-primary facet-box">
          <div class="panel-heading-subjects panel-heading">
            <strong>Related Times</strong>
            <a class="pull-right" style="color:black" data-container="body" data-toggle="popover"
              data-placement="left" data-trigger="focus" tabindex="0" role="button"
              data-content="This list shows relationships to subject terms of Citation records linked to this Authority record.">
              <i class="far fa-question-circle" aria-hidden="true"></i>
            </a>
          </div>
          <div class="panel-body">
            {% for facet in related_timeperiod_facet|slice:"7" %}
            {% include 'isisdata/fragment_facet_link.html' with facet_field='citation_time_period_ids_exact'%}
            {% endfor %}

            {% if related_timeperiod_facet|length > 7 %}
            <button type="button" class="btn btn-xs btn-primary" data-toggle="modal" data-target="#timePeriodModal" style="float:right">
              More <i class="far fa-caret-square-down"></i>
            </button>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

  <!-- facet modals -->
  <div class="modal fade" id="authorModal" tabindex="-1" role="dialog" aria-labelledby="authorModalLabel">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <h4 class="modal-title" id="myModalLabel">Related Authors & Contributors</h4>
        </div>
        <div class="modal-body">
          <ul class="unselected_facets">
            {% for facet in related_contributors_facet %}
            <li>
              {% include 'isisdata/fragment_facet_link.html' with facet_field='citation_all_contributor_ids_exact'%}
            </li>
            {% endfor %}
          </ul>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div><!-- /modal -->
<!-- subject Modal -->
  <div class="modal fade" id="subjectModal" tabindex="-1" role="dialog" aria-labelledby="subjectModalLabel">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <h4 class="modal-title" id="myModalLabel">Related Concepts</h4>
        </div>
        <div class="modal-body">
          <ul class="unselected_facets">
            {% for facet in related_subject_concepts_facet %}
              <li>
                {% include 'isisdata/fragment_facet_link.html' with facet_field='citation_concepts_by_subject_ids' %}
              </li>
            {% endfor %}
          </ul>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div><!-- /modal -->
<!-- institution Modal -->
<div class="modal fade" id="peopleModal" tabindex="-1" role="dialog" aria-labelledby="peopleModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">Related People</h4>
      </div>
      <div class="modal-body">
        <ul class="unselected_facets">
          {% for facet in related_subject_people_facet %}
            <li>
              {% include 'isisdata/fragment_facet_link.html' with facet_field='citation_people_by_subject_ids_exact' %}
            </li>
          {% endfor %}
        </ul>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div><!-- /modal -->

<!-- institution Modal -->
<div class="modal fade" id="institutionModal" tabindex="-1" role="dialog" aria-labelledby="institutionModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">Related Institutions</h4>
      </div>
      <div class="modal-body">
        <ul class="unselected_facets">
          {% for facet in related_subject_institutions_facet %}
            <li>
              {% include 'isisdata/fragment_facet_link.html' with facet_field='citation_institutions_by_subject_ids_exact' %}
            </li>
          {% endfor %}
        </ul>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div><!-- /modal -->

<!-- categories Modal -->
<div class="modal fade" id="categoryModal" tabindex="-1" role="dialog" aria-labelledby="categoryModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">Related Categories</h4>
      </div>
      <div class="modal-body">
        <ul class="unselected_facets">
          {% for facet in related_categories_facet %}
            <li>
              {% include 'isisdata/fragment_facet_link.html' with facet_field='citation_category_ids_exact' %}
            </li>
          {% endfor %}
        </ul>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div><!-- /modal -->

<!-- categories Modal -->
<div class="modal fade" id="timePeriodModal" tabindex="-1" role="dialog" aria-labelledby="timePeriodModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">Related Time Periods</h4>
      </div>
      <div class="modal-body">
        <ul class="unselected_facets">
          {% for facet in related_timeperiod_facet %}
            <li>
              {% include 'isisdata/fragment_facet_link.html' with facet_field='citation_time_period_ids_exact' %}
            </li>
          {% endfor %}
        </ul>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div><!-- /modal -->

<!-- publisher Modal -->
<div class="modal fade" id="publisherModal" tabindex="-1" role="dialog" aria-labelledby="publisherModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">Related Publishers</h4>
      </div>
      <div class="modal-body">
        <ul class="unselected_facets">
          {% for facet in related_publisher_facet %}
            <li>
              {% include 'isisdata/fragment_facet_link.html' with facet_field='citation_publisher_ids' %}
            </li>
          {% endfor %}
        </ul>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div><!-- /modal -->


<!-- publisher Modal -->
<div class="modal fade" id="journalModal" tabindex="-1" role="dialog" aria-labelledby="journalModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">Related Journals</h4>
      </div>
      <div class="modal-body">
        <ul class="unselected_facets">
          {% for facet in related_journal_facet %}
            <li>
              {% include 'isisdata/fragment_facet_link.html' with facet_field='citation_periodical_ids' %}
            </li>
          {% endfor %}
        </ul>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div><!-- /modal -->

<div ng-app="commentsApp">
    <div class="col-md-12" style="padding-top: 15px">
      <div class="col-sm-12 main" style="padding-top: 15px">
        {% include "isisdata/comments.html" %}
      </div>
    </div>

</div>

<script>
  $(function () {
    $('[data-toggle="popover"]').popover()
  })
</script>

{% endblock %}
