{% extends "isisdata/__base.html" %}
{% load app_filters %}
{% load staticfiles %}

{% block extra_head %}
<script>
{% if source_instance_id %}
var SUBJECT_INSTANCE_ID = "{{ source_instance_id }}";
{% endif %}

{% if source_content_type %}
var SUBJECT_CONTENT_TYPE = {{ source_content_type }};
{% endif %}
</script>

<script src="{% static "isisdata/js/comments.js" %}"></script>

<meta property="og:url"                content="{{ request.build_absolute_uri }}" />
<meta property="og:site_name"          content="Isis Current Bibliography" />
<meta property="og:type"               content="article" />
<meta property="fb:app_id"             content="{{ facebook_app_id}}" />
<meta property="og:title"              content="{{ authority.name|strip_tags }}" />
<meta property="og:description"        content="{{ authority.description|strip_tags }}" />
<!-- TODO: -vv- if we add images for entries, this should be changed. -vv-  -->
<meta property="og:image"              content="{% static "isisdata/images/isis_final_black.png" %}" />
{% endblock %}



{% block title %}Authority{% endblock %}

{% block content %}
<div class="row" ng-app="commentsApp">
  <div class="col-sm-3 col-md-2 sidebar">
    <div class="menu">
      <a href="javascript:window.history.back()"><span class="glyphicon glyphicon-arrow-left"></span></a>
      &nbsp; &nbsp;
      <a href="{% url 'index' %}"><span class="glyphicon glyphicon-home"></span></a>
      &nbsp; &nbsp;
      <a href="{% url 'haystack_search' %}"><span class="glyphicon glyphicon-search"></span></a>
      <hr>
    </div>
  </div>
  <div class="col-sm-offset-3 col-md-offset-2 main col-sm-5 col-md-7">
    <div class="alert alert-warning headerbox" role="alert">{{ authority.get_type_controlled_display }}
        <span class="btn-grp pull-right">
            {% if user.is_staff %}<a class="btn btn-small glyphicon glyphicon-edit" href="{% url "admin:isisdata_authority_change" authority.id %}"></a>{% endif %}
            <a class="btn btn-small glyphicon glyphicon-console" href="{{ api_view}}" data-toggle="tooltip" data-placement="top" title="View in REST API"></a>
        </span>


    </div>

    {% if redirect_from %}<p class="text-muted text-danger"><em>Redirected from <strong>{{ redirect_from.name }}</strong> ({{ redirect_from.id }}).</em></p>{% endif %}

    <h3>{{ authority.name }}</h3>

    <p><strong>Description:</strong> {{ authority.description }}</p>

    {% for attribute in authority.attributes.all %}
    <p><strong>{% if attribute.type_free %}{{ attribute.type_free }}{% else %}{{ attribute.type_controlled }}{% endif %}:</strong> {{ attribute.value_freeform }}</p>
    {% endfor %}

    <table class="details">
      <tr>
        <td>Linked Data:</td>
        <td>{% for entry in citation.linkeddata_entries.all %}<a href="{{ entry|linkeddata_for_display }}" taget="_blank">{{ entry.universal_resource_name }}</a> ({{ entry.type_controlled }})<br/> {% endfor %}</td>
      </tr>
      <tr>
        <td>Citation URI:</td>
        <td>{{ authority | get_uri }}</td>
      </tr>
    </table>

    {% if citations_by %}
    {{ page_by }}
    <h4>Resources by {{ authority.name }}</h4>
    <div class="results-info">Showing {{ citations_by.start_index }} to {{ citations_by.end_index }} of {{ citations_by.paginator.count }}.</div>

      {% for rel_citation in citations_by %}
        <p>
          <span class="glyphicon glyphicon-book"></span>
          {% if rel_citation.citation|get_authors %}
          {% for author in rel_citation.citation|get_authors %} {{ author.authority.name }};{% endfor %}<br>
          {% endif %}
          <a href="{% url 'citation' rel_citation.citation.id %}">{{ rel_citation.citation|get_title }}</a></li>
        </p>
      {% endfor %}
      {% if citations_by.has_previous or citations_by.has_next %}
      <nav>
        <ul class="pagination">
          <li class="disabled"><a>Go to page: </a></li>
          <li>
            {% if citations_by.has_previous %}
            <a href="?page-by={{ citations_by.previous_page_number }}" aria-label="Previous">
              <span aria-hidden="true">&laquo;</span>
            </a>
            {% else %}
            <li class="disabled">
              <a href="?page-by={{ citations_by.number }}" aria-label="Previous">
                <span aria-hidden="true">&laquo;</span>
              </a>
            </li>
            {% endif %}
            {% if citations_by.has_previous or citations_by.has_next %}
            {% for page in citations_by.paginator.page_range %}
                <li {% if citations_by.number == page %} class="disabled" {% endif %}><a href="?page-by={{ page }}">{{ page }}</a></li>
            {% endfor %}
            {% endif %}
            {% if citations_by.has_next %}
            <li>
              <a href="?page-by={{ citations_by.next_page_number }}" aria-label="Next">
                <span aria-hidden="true">&raquo;</span>
              </a>
            </li>
            {% else %}
            <li class="disabled">
              <a href="?page-by={{ citations_by.number }}" aria-label="Next">
                <span aria-hidden="true">&raquo;</span>
              </a>
            </li>
            {% endif %}
          </ul>
        </nav>
    {% endif %}
    {% endif %}

    {% if citations_about %}
    <h4>Resources about {{ authority.name }}</h4>

      <div class="results-info">Showing {{ citations_about.start_index }} to {{ citations_about.end_index }} of {{ citations_about.paginator.count }}.</div>

      {% for rel_citation in citations_about %}
        <p>
          <span class="glyphicon glyphicon-book"></span>
          {% if rel_citation.citation|get_authors %}
          {% for author in rel_citation.citation|get_authors %} {{ author.authority.name }};{% endfor %}<br>
          {% endif %}
          <a href="{% url 'citation' rel_citation.citation.id %}">{{ rel_citation.citation|get_title }}</a></li>
        </p>
      {% endfor %}

      {% if citations_about.has_previous or citations_about.has_next %}
      <nav>
        <ul class="pagination">
          <li class="disabled"><a>Go to page: </a></li>
          <li>
            {% if citations_about.has_previous %}
            <a href="?page-about={{ citations_about.previous_page_number }}" aria-label="Previous">
              <span aria-hidden="true">&laquo;</span>
            </a>
            {% else %}
            <li class="disabled">
              <a href="?page-about={{ citations_about.number }}" aria-label="Previous">
                <span aria-hidden="true">&laquo;</span>
              </a>
            </li>
            {% endif %}
            {% if citations_about.has_previous or citations_about.has_next %}
            {% for page in citations_about.paginator.page_range %}
                <li {% if citations_about.number == page %} class="active" {% endif %}><a href="?page-about={{ forloop.counter }}">{{ page }}</a></li>
            {% endfor %}
            {% endif %}
            {% if citations_about.has_next %}
            <li>
              <a href="?page-about={{ citations_about.next_page_number }}" aria-label="Next">
                <span aria-hidden="true">&raquo;</span>
              </a>
            </li>
            {% else %}
            <li class="disabled">
              <a href="?page-about={{ citations_about.number }}" aria-label="Next">
                <span aria-hidden="true">&raquo;</span>
              </a>
            </li>
            {% endif %}
          </ul>
        </nav>
    {% endif %}
    {% endif %}

    {% if citations_other %}
    <h4>Resources about {{ authority.name }}</h4>

      {% for rel_citation in citations_other %}
          <p>
            <span class="glyphicon glyphicon-book"></span>
            {% if rel_citation.citation|get_authors %}
            {% for author in rel_citation.citation|get_authors %} {{ author.authority.name }};{% endfor %}<br>
            {% endif %}
            <a href="{% url 'citation' rel_citation.citation.id %}">{{ rel_citation.citation|get_title }}</a>
          </p>
      {% endfor %}

      {% if citations_other.has_previous or citations_other.has_next %}
      <nav>
        <ul class="pagination">
          <li class="disabled"><a>Go to page</a></li>
          <li>
            {% if citations_other.has_previous %}
            <a href="?page-other={{ citations_other.previous_page_number }}" aria-label="Previous">
              <span aria-hidden="true">&laquo;</span>
            </a>
            {% else %}
            <li class="disabled">
              <a href="?page-other={{citations_other.number}}" aria-label="Previous">
                <span aria-hidden="true">&laquo;</span>
              </a>
            </li>
            {% endif %}
            {% if citations_other.has_previous or citations_other.has_next %}
            {% for page in citations_other.paginator.page_range %}
                <li><a href="?page-other={{ forloop.counter }}">{{ page }}</a></li>
            {% endfor %}
            {% endif %}
            {% if citations_other.has_next %}
            <li>
              <a href="?page-other={{ citations_other.next_page_number }}" aria-label="Next">
                <span aria-hidden="true">&raquo;</span>
              </a>
            </li>
            {% else %}
            <li class="disabled">
              <a href="?page={{ citations_other.number }}" aria-label="Next">
                <span aria-hidden="true">&raquo;</span>
              </a>
            </li>
            {% endif %}
          </ul>
        </nav>
        {% endif %}
    {% endif %}
    </div>


    <div class="col-sm-4 col-md-3 main">
        {% include "isisdata/comments.html" %}
    </div>
  </div>


</div>
{% endblock %}
